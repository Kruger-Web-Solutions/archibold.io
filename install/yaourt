#########################
# archibold.io (C) 2019 #
#########################

if [ "$(which sudo 2> /dev/null)" = "" ]; then
  if [ "$(which so 2> /dev/null)" = "" ]; then
    bash <(curl -s https://archibold.io/install/sudo)
  else
    alias sudo=so
  fi
fi

if [ "$(which yaourt 2> /dev/null)" = "" ]; then
  echo "
$(tput bold)yaourt installer$(tput sgr0)
"
  echo  " installing dependencies"
  echo  " ( this might take a while )"
  sudo pacman -Sy --needed --noconfirm base-devel binutils diffutils gettext linux-headers git diffstat chrpath wget cpio pv yajl
  mkdir -p /home/tmp-yaourt-install

  rm -rf /home/tmp-yaourt-install/*
  cd /home/tmp-yaourt-install
  pkgname=package-query
  pkgver=1.9
  curl -LO https://mir.archlinux.fr/releases/$pkgname/$pkgname-$pkgver.tar.gz
  tar -xzf ./$pkgname-$pkgver.tar.gz
  cd $pkgname-$pkgver
  ./configure --localstatedir=/var --prefix=/usr --sysconfdir=/etc --with-aur-url=https://aur.archlinux.org
  make
  sudo make install

  rm -rf /home/tmp-yaourt-install/*
  cd /home/tmp-yaourt-install
  pkgname=yaourt
  pkgver=1.9
  curl -LO https://github.com/archlinuxfr/$pkgname/releases/download/$pkgver/$pkgname-$pkgver.tar.gz
  tar -xzf ./$pkgname-$pkgver.tar.gz
  cd $pkgname-$pkgver
  make PREFIX=/usr sysconfdir=/etc localstatedir=/var
  sudo make PREFIX=/usr sysconfdir=/etc localstatedir=/var install
fi
