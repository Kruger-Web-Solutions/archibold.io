#########################
# archibold.io (C) 2016 #
#########################

if [ "$(which sudo 2> /dev/null)" = "" ]; then
  bash <(curl -s https://archibold.io/install/sudo)
fi

if [ "$DISABLE_WAYLAND" = "" ]; then
  echo "
  Would you like to disable Wayland ? [y/N]

Only if your drivers work best in legacy Xorg,
or you are installing on Virtual Box, type y
"
  read -n1 -s DISABLE_WAYLAND
fi

if [ "$USE_GNOME_SOFTWARE" = "" ]; then
  echo "
  Would you like to use GNOME Software ? [y/N]

You can always use discover or pamac instead.
"
  read -n1 -s USE_GNOME_SOFTWARE
fi

echo "please wait for the GPU setup ..."

source <(curl -s https://archibold.io/install/gpu)

echoWithHeader "
  Installing GNOME with GPU drivers:
  $GPU_DRIVERS
"

sudo pacman -S --needed --noconfirm \
    gnome gnome-tweaks \
    xf86-input-libinput xsel \
    cups system-config-printer \
    ttf-dejavu ttf-liberation ttf-freefont noto-fonts noto-fonts-emoji noto-fonts-extra \
    bluez bluez-utils

echoWithHeader "
  Enabling NetworkManager and GDM
"

sudo systemctl enable NetworkManager
sudo systemctl enable gdm

if [ "$USE_GNOME_SOFTWARE" != "y" ] || [ "$USE_GNOME_SOFTWARE" != "Y" ]; then
  echoWithHeader "
  Removing unnecessary software
"
  sudo pacman -Rs --noconfirm gnome-software gnome-boxes
else
  sudo pacman -S --needed --noconfirm \
    gnome-packagekit gnome-software-packagekit-plugin flatpak
fi

if [ "$DISABLE_WAYLAND" = "y" ] || [ "$DISABLE_WAYLAND" = "Y" ]; then
  sudo sed -ie 's/#WaylandEnable=false/WaylandEnable=false/' /etc/gdm/custom.conf
fi

echoWithHeader "
  Installing common filesystem utilities (read/write)
"
source <(curl -s https://archibold.io/install/fsutils)

## old minimal setup (not really worth it)
# sudo pacman -S --needed --noconfirm \
#     gdm gnome-shell gnome-shell-extensions \
#     gnome-terminal gnome-control-center gnome-tweak-tool \
#     gnome-settings-daemon gnome-keyring gnome-disk-utility \
#     gnome-system-monitor gnome-backgrounds gnome-calculator \
#     gnome-screenshot gnome-photos evince \
#     networkmanager network-manager-applet polkit-gnome \
#     xdg-utils xdg-user-dirs-gtk xdg-desktop-portal-gtk \
#     eog totem \
#     xf86-input-libinput \
#     ttf-dejavu ttf-liberation ttf-freefont noto-fonts noto-fonts-emoji noto-fonts-extra
